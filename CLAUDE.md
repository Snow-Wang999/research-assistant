# CLAUDE.md

> Claude Code é¡¹ç›®æŒ‡å¼•æ–‡ä»¶ - æ–°å¯¹è¯å¿…è¯»

---

## é¡¹ç›®æ¦‚è¿°

**ç§‘ç ”åŠ©æ‰‹Agent** - å¸®åŠ©ç ”ç©¶äººå‘˜å¿«é€Ÿæœç´¢ã€åˆ†æå’Œæ•´ç†å­¦æœ¯è®ºæ–‡ã€‚

### æ ¸å¿ƒç‰¹æ€§
1. **æ„å›¾è·¯ç”±**: è‡ªåŠ¨åŒºåˆ†ç®€å•æŸ¥è¯¢(RAG)å’Œå¤æ‚æŸ¥è¯¢(Deep Research)
2. **å¤šæºæœç´¢**: å¹¶è¡Œæœç´¢ arXiv + Semantic Scholar
3. **è¯­ä¹‰å‹ç¼©**: å‡å°‘Tokenæ¶ˆè€—ï¼Œè§£å†³Contextçˆ†ç‚¸é—®é¢˜
4. **æœ¬åœ°è®ºæ–‡åº“**: (Phase 2) ä½¿ç”¨Claudeå¤šæ¨¡æ€è¯»å–æœ¬åœ°PDF

### é¡¹ç›®å®šä½
- å¯¹æ ‡: Perplexityã€Elicitã€Consensus
- å·®å¼‚åŒ–: æœ¬åœ°è®ºæ–‡åº“ç®¡ç†ï¼ˆç«å“ä¸å…·å¤‡ï¼‰

---

## è™šæ‹Ÿç¯å¢ƒï¼ˆé‡è¦ï¼‰

**Claude Code å¿…é¡»ä½¿ç”¨é¡¹ç›®è™šæ‹Ÿç¯å¢ƒä¸­çš„ Pythonï¼š**

```bash
# âœ… æ­£ç¡®ï¼šä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ Pythonï¼ˆéœ€è¦è®¾ç½®ç¼–ç ï¼‰
export PYTHONIOENCODING=utf-8
.venv/Scripts/python.exe run.py
.venv/Scripts/python.exe -m pytest tests/ -v

# âŒ é”™è¯¯ï¼šä½¿ç”¨ç³»ç»Ÿ Python
python run.py
```

- è™šæ‹Ÿç¯å¢ƒè·¯å¾„ï¼š`.venv/Scripts/python.exe`
- Python ç‰ˆæœ¬ï¼š3.9.13
- ä¾èµ–å·²é€šè¿‡ `uv sync` å®‰è£…
- **Git Bash ä¸­æ–‡ä¹±ç **ï¼šå¿…é¡»å…ˆ `export PYTHONIOENCODING=utf-8`

---

## å¿«é€Ÿå‘½ä»¤

```bash
# å¯åŠ¨é¡¹ç›®ï¼ˆä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼‰
.venv/Scripts/python.exe run.py              # CLIæ¨¡å¼
.venv/Scripts/python.exe run.py --web        # Webç•Œé¢ (http://127.0.0.1:7860)
.venv/Scripts/python.exe run.py --web --share  # ç”Ÿæˆå…¬å¼€é“¾æ¥

# ç¯å¢ƒè®¾ç½®ï¼ˆé¦–æ¬¡ï¼‰
uv venv && .venv\Scripts\activate && uv sync

# æµ‹è¯•
.venv/Scripts/python.exe -m pytest tests/ -v
```

---

## é¡¹ç›®ç»“æ„

```
research-assistant/
â”œâ”€â”€ run.py                    # ç»Ÿä¸€å¯åŠ¨è„šæœ¬
â”œâ”€â”€ CLAUDE.md                 # æœ¬æ–‡ä»¶ï¼ˆå¿…è¯»ï¼‰
â”œâ”€â”€ TODO.md                   # è¿›åº¦è¿½è¸ª
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.py               # ä¸»å…¥å£ + ResearchAssistantç±»
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â””â”€â”€ intent_router.py  # æ„å›¾è·¯ç”±ï¼ˆsimple/deep_researchï¼‰
â”‚   â”œâ”€â”€ tools/search/
â”‚   â”‚   â”œâ”€â”€ semantic_scholar.py  # Semantic Scholar API
â”‚   â”‚   â”œâ”€â”€ arxiv_search.py      # arXiv API
â”‚   â”‚   â””â”€â”€ unified_search.py    # ç»Ÿä¸€æœç´¢å™¨ï¼ˆå¹¶è¡Œ+å»é‡ï¼‰
â”‚   â”œâ”€â”€ rag/
â”‚   â”‚   â””â”€â”€ compressor.py     # è¯­ä¹‰å‹ç¼©å™¨
â”‚   â””â”€â”€ utils/config.py       # é…ç½®ç®¡ç†
â”‚
â”œâ”€â”€ ui/
â”‚   â””â”€â”€ app.py                # Gradio Webç•Œé¢
â”‚
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ eval/test_cases.json  # è¯„ä¼°ç”¨ä¾‹
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ architecture.md       # æ¶æ„å›¾
    â”œâ”€â”€ design_decisions.md   # è®¾è®¡å†³ç­–è®°å½•(ADR)
    â””â”€â”€ development_guide.md  # å¼€å‘æŒ‡å—
```

---

## æ¶æ„è¦ç‚¹

### V3æ¶æ„ï¼ˆæ¥è‡ªOpen Deep Researchï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æŸ¥è¯¢     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Intent Routerâ”‚  â† åˆ¤æ–­: simple / deep_research
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”œâ”€â”€ simple â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                        â”‚
       â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¿«é€ŸRAGæ£€ç´¢  â”‚          â”‚ æ·±åº¦ç ”ç©¶     â”‚
â”‚ (5ç¯‡è®ºæ–‡)    â”‚          â”‚ (10ç¯‡+å¤šè½®)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚
       â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è¯­ä¹‰å‹ç¼©                   â”‚  â† å‡å°‘Token
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿”å›ç»“æœ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè®¾è®¡æ€æƒ³
1. **Subagent as Tool**: å­Agentä½œä¸ºå·¥å…·è°ƒç”¨ï¼Œéš”ç¦»ä¸Šä¸‹æ–‡
2. **LLMè¯­ä¹‰å‹ç¼©**: æœç´¢ç»“æœå…ˆå‹ç¼©å†è¿”å›
3. **Search-first-then-structure**: å…ˆå¹¿æ³›æœç´¢ï¼Œå†ç»“æ„åŒ–

### æ„å›¾è·¯ç”±è§„åˆ™
```python
å¤æ‚å…³é”®è¯: å¯¹æ¯”ã€æ¯”è¾ƒã€ç»¼è¿°ã€è¶‹åŠ¿ã€åˆ†æ â†’ deep_research
ç®€å•å…³é”®è¯: æ˜¯ä»€ä¹ˆã€å®šä¹‰ã€ä½œè€…æ˜¯è° â†’ simple
é»˜è®¤: é•¿åº¦ > 30å­—ç¬¦ â†’ deep_research
```

---

## å…³é”®ä»£ç ä½ç½®

| åŠŸèƒ½ | æ–‡ä»¶ | æ ¸å¿ƒç±»/å‡½æ•° |
|------|------|-------------|
| ä¸»å…¥å£ | `src/main.py` | `ResearchAssistant.process_query()` |
| æ„å›¾è·¯ç”± | `src/agents/intent_router.py` | `IntentRouter.route()` |
| ç»Ÿä¸€æœç´¢ | `src/tools/search/unified_search.py` | `UnifiedSearch.search()` |
| arXivæœç´¢ | `src/tools/search/arxiv_search.py` | `ArxivSearch.search()` |
| è¯­ä¹‰å‹ç¼© | `src/rag/compressor.py` | `SemanticCompressor.compress()` |
| Webç•Œé¢ | `ui/app.py` | `create_app()` |

---

## å¼€å‘é˜¶æ®µ

### Phase 1 - MVP âœ… å·²å®Œæˆ
- [x] æ„å›¾è·¯ç”±å™¨
- [x] arXiv + Semantic Scholar æœç´¢
- [x] ç»Ÿä¸€æœç´¢å™¨ï¼ˆå¹¶è¡Œ+å»é‡ï¼‰
- [x] CLI + Webç•Œé¢
- [x] åŸºç¡€è¯­ä¹‰å‹ç¼©

### Phase 2 - æ ¸å¿ƒåŠŸèƒ½ ğŸ“‹ å¾…å¼€å§‹
- [ ] Deep Research å¤šè½®æœç´¢
- [ ] LLMè¯­ä¹‰å‹ç¼©ï¼ˆæ›¿æ¢è§„åˆ™ç‰ˆï¼‰
- [ ] **æœ¬åœ°PDFè®ºæ–‡åº“**ï¼ˆå·®å¼‚åŒ–åŠŸèƒ½ï¼‰
- [ ] å‘é‡æ•°æ®åº“ï¼ˆChromaï¼‰
- [ ] å¯¹è¯è®°å¿†

### Phase 3 - é«˜çº§åŠŸèƒ½
- [ ] å¤šAgentåä½œ
- [ ] ç ”ç©¶æŠ¥å‘Šç”Ÿæˆ
- [ ] MCP Serveré›†æˆ

---

## å¸¸è§ä»»åŠ¡

### æ·»åŠ æ–°æœç´¢æº
1. åˆ›å»º `src/tools/search/xxx_search.py`
2. å®ç° `search(query, limit) -> List[Paper]`
3. åœ¨ `unified_search.py` æ³¨å†Œ
4. æ›´æ–° `__init__.py`

### ä¿®æ”¹è·¯ç”±è§„åˆ™
ç¼–è¾‘ `src/agents/intent_router.py` ä¸­çš„:
- `SIMPLE_KEYWORDS`
- `COMPLEX_KEYWORDS`

### è°ƒæ•´Webç•Œé¢
ç¼–è¾‘ `ui/app.py`ï¼Œä½¿ç”¨Gradioç»„ä»¶

---

## ç›¸å…³æ–‡æ¡£

- [æ¶æ„æ–‡æ¡£](docs/architecture.md) - ç³»ç»Ÿæ¶æ„å›¾
- [è®¾è®¡å†³ç­–](docs/design_decisions.md) - ADRè®°å½•
- [å¼€å‘æŒ‡å—](docs/development_guide.md) - æ–°æ‰‹å…¥é—¨
- [è¿›åº¦è¿½è¸ª](TODO.md) - å½“å‰çŠ¶æ€

---

## ç¯å¢ƒå˜é‡

```bash
# .env æ–‡ä»¶
SEMANTIC_SCHOLAR_API_KEY=   # å¯é€‰ï¼Œæé«˜APIé™é¢
OPENAI_API_KEY=             # Phase 2 LLMè°ƒç”¨
ANTHROPIC_API_KEY=          # Phase 2 Claudeè°ƒç”¨
```

---

## ç¼–ç è§„èŒƒ

- ä¸­æ–‡æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²
- PEP 8 é£æ ¼ï¼ˆruffæ£€æŸ¥ï¼‰
- å¿…é¡»æ·»åŠ ç±»å‹æ³¨è§£
- æ¯ä¸ªæ¨¡å—åŒ…å« `if __name__ == "__main__"` æµ‹è¯•ä»£ç 
