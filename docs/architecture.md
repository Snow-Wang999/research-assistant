# 科研助手架构文档

## 1. 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                        用户界面层                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │
│  │   Web UI    │  │    CLI      │  │    API      │          │
│  │  (Gradio)   │  │  (main.py)  │  │  (FastAPI)  │          │
│  └─────────────┘  └─────────────┘  └─────────────┘          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                       Agent 协调层                           │
│  ┌─────────────────────────────────────────────────────┐    │
│  │              Intent Router (意图路由)                 │    │
│  │         决定使用 RAG 模式 还是 Deep Research 模式      │    │
│  └─────────────────────────────────────────────────────┘    │
│                    │                    │                    │
│           ┌───────┴───────┐    ┌───────┴───────┐            │
│           ▼               ▼    ▼               ▼            │
│    ┌─────────────┐  ┌─────────────────────────────┐         │
│    │  RAG Mode   │  │      Deep Research Mode     │         │
│    │ (简单查询)   │  │    (复杂查询/对比分析)        │         │
│    └─────────────┘  └─────────────────────────────┘         │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        工具层                                │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │ Paper Search │  │  PDF Parser  │  │  Compressor  │       │
│  │(Semantic     │  │ (本地论文)    │  │ (语义压缩)    │       │
│  │ Scholar)     │  │              │  │              │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        存储层                                │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │   Memory     │  │  Vector DB   │  │   Cache      │       │
│  │ (对话记忆)    │  │  (Chroma)    │  │  (Redis)     │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
└─────────────────────────────────────────────────────────────┘
```

## 2. 核心模块

### 2.1 意图路由器 (Intent Router)

**位置**: `src/agents/intent_router.py`

**职责**: 分析用户查询，决定使用哪种处理模式

**路由规则**:
- **Simple模式**: 简单事实查询（是什么、定义、作者）
- **Deep Research模式**: 复杂分析（对比、综述、趋势分析）

### 2.2 论文搜索 (Semantic Scholar)

**位置**: `src/tools/search/semantic_scholar.py`

**职责**: 调用Semantic Scholar API搜索论文

**核心方法**:
- `search(query, limit)`: 搜索论文
- `get_paper(paper_id)`: 获取单篇论文详情

### 2.3 语义压缩器 (Semantic Compressor)

**位置**: `src/rag/compressor.py`

**职责**: 压缩搜索结果，减少Token消耗

**核心思想**: V3架构的关键技术，使用LLM对内容进行语义压缩

## 3. 技术选型

| 组件 | 技术选择 | 理由 |
|------|---------|------|
| Web框架 | Gradio | 快速原型，科研友好 |
| 论文搜索 | Semantic Scholar | 免费API，学术论文覆盖广 |
| HTTP客户端 | httpx | 现代异步支持，更好的错误处理 |
| 向量数据库 | Chroma | 轻量级，本地部署 |
| LLM调用 | LiteLLM | 统一多家模型API |

## 4. 数据流

```
用户查询
    │
    ▼
┌─────────────┐
│ Intent Route│  ← 判断查询类型
└─────────────┘
    │
    ├── simple ──────┬── deep_research
    │                │
    ▼                ▼
┌─────────┐    ┌─────────────┐
│搜索5篇  │    │搜索10篇    │
│论文     │    │生成子问题   │
└─────────┘    │多轮搜索     │
    │          └─────────────┘
    │                │
    ▼                ▼
┌─────────────────────────┐
│      语义压缩            │  ← 减少Token消耗
└─────────────────────────┘
    │
    ▼
┌─────────────────────────┐
│      生成回答            │
└─────────────────────────┘
    │
    ▼
返回给用户
```

## 5. 扩展计划

### Phase 1 (MVP)
- [x] 意图路由
- [x] Semantic Scholar搜索
- [x] 基础语义压缩
- [x] CLI界面
- [x] Gradio Web界面

### Phase 2
- [ ] Deep Research多轮搜索
- [ ] 本地PDF论文库
- [ ] 向量检索
- [ ] 对话记忆

### Phase 3
- [ ] 多Agent协作
- [ ] 报告生成
- [ ] 知识图谱
- [ ] MCP集成
